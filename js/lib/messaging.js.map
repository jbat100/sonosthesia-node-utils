{"version":3,"sources":["../ts/lib/messaging.ts"],"names":[],"mappings":"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","file":"messaging.js","sourcesContent":["\r\nimport * as _ from \"underscore\";\r\nimport { expect } from 'chai';\r\n\r\nimport { NativeClass, MessageContentParser } from './core';\r\nimport { ComponentInfo } from './component';\r\n\r\n\r\nexport class Parameters extends NativeClass {\r\n\r\n    private _values = {};\r\n\r\n    static newFromJson(obj : any) {\r\n        expect(obj).to.be.an('object');\r\n        const parameters = new this();\r\n        _.each(obj, (value, key : string) => {\r\n            expect(key).to.be.a('string');\r\n            if (typeof value === 'number') value = [value];\r\n            if (!_.isArray(value)) throw new Error('value should be number or array');\r\n            parameters.setParameter(key, value);\r\n        });\r\n        return parameters;\r\n    }\r\n\r\n    getKeys() : string[] {\r\n        return _.keys(this._values);\r\n    }\r\n\r\n    setParameter(key : string, value : number[]) {\r\n        if (!key) throw new Error('invalid key');\r\n        this._values[key] = value;\r\n    }\r\n\r\n    getParameter(key : string) : number[]  {\r\n        if (!_.has(this._values, key)) throw new Error('unknown key');\r\n        return this._values[key];\r\n    }\r\n\r\n}\r\n\r\n\r\nexport class MessageContent extends NativeClass {\r\n\r\n}\r\n\r\nexport class ComponentMessageContent extends MessageContent {\r\n\r\n    static newFromJson(obj : any) {\r\n        expect(obj.component).to.be.an('object');\r\n        const component : ComponentInfo = ComponentInfo.newFromJSON(obj.component) as ComponentInfo;\r\n        return new this(component);\r\n    }\r\n\r\n    constructor(private _component : ComponentInfo) {\r\n        super();\r\n    }\r\n\r\n    get component() : ComponentInfo { return this._component; }\r\n\r\n}\r\n\r\n/**\r\n * Abstract base for control, create and destroy messages\r\n */\r\n\r\nexport class ChannelMessageContent extends MessageContent {\r\n\r\n    static newFromJson(obj : any) {\r\n        expect(obj.component).to.be.an('object');\r\n        expect(obj.component).to.be.a('string');\r\n        expect(obj.channel).to.be.a('string');\r\n        expect(obj.object).to.be.a('string');\r\n        return new this(obj.component, obj.channel, obj.object, Parameters.newFromJson(obj.parameters));\r\n    }\r\n\r\n    constructor(private _component : string,\r\n                private _channel : string,\r\n                private _object : string,\r\n                private _parameters : Parameters) {\r\n\r\n        super();\r\n    }\r\n\r\n    get component() : string { return this._component; }\r\n\r\n    get channel() : string { return this._channel; }\r\n\r\n    get object() : string { return this._object; }\r\n\r\n    get parameters() : Parameters { return this._parameters; }\r\n\r\n}\r\n\r\nexport class ControlMessageContent extends ChannelMessageContent { }\r\n\r\nexport class ActionMessageContent extends ChannelMessageContent { }\r\n\r\n/**\r\n * Object cannot be null\r\n */\r\nexport class ObjectMessageContent extends ChannelMessageContent {\r\n\r\n    constructor(component : string, channel : string, object : string, parameters : Parameters) {\r\n        expect(object).to.be.ok;\r\n        super(component, channel, object, parameters);\r\n    }\r\n\r\n}\r\n\r\nexport class CreateMessageContent extends ObjectMessageContent { }\r\n\r\nexport class DestroyMessageContent extends ObjectMessageContent { }\r\n\r\n\r\n\r\nexport enum HubMessageType {\r\n    component,\r\n    action,\r\n    control,\r\n    create,\r\n    destroy\r\n}\r\n\r\nexport class HubMessageContentParser extends MessageContentParser {\r\n\r\n    private _contentClasses = {\r\n        'component' : ComponentMessageContent,\r\n        'control' : ControlMessageContent,\r\n        'action' : ActionMessageContent,\r\n        'create': CreateMessageContent,\r\n        'destroy': DestroyMessageContent\r\n    };\r\n\r\n    parse(type : string, content : any) : any {\r\n        if (!_.has(this._contentClasses, type)) throw new Error('unsupported message type : ' + type);\r\n        return this._contentClasses[type].newFromJson(content);\r\n    }\r\n\r\n}"]}